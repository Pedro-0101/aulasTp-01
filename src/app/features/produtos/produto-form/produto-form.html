<section class="form-container">
    <h2>Novo Produto</h2>

    <form #formulario="ngForm" (ngSubmit)="onSubmit(formulario)">
        <div class="campo">
            <label for="nome">Nome</label>
            <input type="text" id="nome" name="nome" required [(ngModel)]="novoProduto.nome" required minlength="3" />
            <small class="erro" [hidden]="!(formulario.controls['nome'].dirty && formulario.controls['nome'].invalid)">
                Nome é obrigatório e deve ter no mínimo 3 caracteres.
            </small>
        </div>
        <div class="campo">
            <label for="preco">Preço</label>
            <input type="number" id="preco" name="preco" required [(ngModel)]="novoProduto.preco" required min="0" />
            @if(formulario.controls['preco']?.dirty && formulario.controls['preco']?.invalid) {
            <small class="erro">
                Preço é obrigatório e deve ser um valor positivo.
            </small>
            }
        </div>
        <div class="campo">
            <label for="descricao">Descrição</label>
            <textarea id="descricao" name="descricao" required [(ngModel)]="novoProduto.descricao" required></textarea>
            @if(formulario.controls['descricao']?.dirty && formulario.controls['descricao']?.invalid) {
            <small class="erro">
                Informe a descrição do produto.
            </small>
            }
        </div>
        <div class="campo">
            <label for="categoria">Categoria</label>
            <select id="categoria" name="categoria" [(ngModel)]="categoriaSelecionada" required>
                <option value="" disabled>Selecione...</option>
                @for(categoria of categorias(); track categoria) {
                <option [value]="categoria">{{ categoria }}</option>
                }
            </select>
            <small class="erro"
                [hidden]="!(formulario.controls['categoria']?.dirty && formulario.controls['categoria']?.invalid)">
                Selecione uma categoria
            </small>
        </div>

        @if(mostrarNovaCategoria()) {
        <div class="campo">
            <label for="novaCategoria">Nova Categoria</label>
            <input type="text" id="novaCategoria" name="novaCategoria" [(ngModel)]="novaCategoria" required
                placeholder="Digite o nome da nova categoria" />
            @if(mostrarNovaCategoria() && formulario.controls['novaCategoria']?.dirty &&
            formulario.controls['novaCategoria']?.invalid && novaCategoria().trim() === '') {
                <small class="erro">
                    Informe o nome da nova categoria.
                </small>
            }
        </div>
        }
        <div class="campo">
            <label for="imageUrl">URL da imagem</label>
            <input type="text" id="imageUrl" name="imageUrl" [(ngModel)]="novoProduto.imageUrl" required />
            @if(formulario.controls['imageUrl']?.dirty && formulario.controls['imageUrl']?.invalid) {
                <small class="erro">Informe a url da imagem</small>
            }
        </div>
        <div class="campo">
            <label for="promo">
                <input type="checkbox" id="promo" name="promo" [(ngModel)]="novoProduto.promo" />
                Em promoção
            </label>
        </div>
        <div class="botoesform">
            <button type="submit" [disabled]="enviando()">Salvar produto</button>
            <button type="button" class="botaoCancelar" (click)="onReturnToList()">Cancelar</button>
        </div>

        @if(mensagem()) {
            <p class="mensagem">{{ mensagem() }}</p>
        }
    </form>
</section>